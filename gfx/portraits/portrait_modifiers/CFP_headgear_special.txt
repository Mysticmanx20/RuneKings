cfp_headgear_special = {

	usage = game
	selection_behavior = weighted_random
	priority = 6

## Duplicate from vanilla to avoid priority issues

	no_hat = {
		usage = game
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = no_headgear
				value = 0
			}
		}
		outfit_tags = { no_clothes nightgown }
		weight = {
			base = 0
			modifier = {
				add = 10000
				OR = {
					portrait_wear_no_headgear_trigger = yes
					activity_tournament_shirtless_trigger = yes
				}
			}
		}
	}
	
## Junky fix for veils being assigned everywhere
    no_veil = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = additive_headgear
                template = no_additive
                range = { 0 1 } # For the randomness to work correctly
            }
        }
        weight = {
            base = 0
            modifier = {
                add = 100
				exists = this
				OR = {
					OR = { 
						portrait_wear_armor_trigger = yes
						portrait_wear_armor_currently_in_army_trigger = yes
					}
					portrait_wear_no_headgear_trigger = yes
					NOT = { is_adult = yes }
					AND = {
						is_landed = yes 
						government_has_flag = government_is_theocracy 
					}
				}
            }
        }
    }

## Traits ##
	
	cfp_rre_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = cfp_rre_imperial
				range = { 0 1 }
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 60
				exists = this
				NOR = {
					portrait_wear_no_headgear_trigger = yes
					portrait_wear_helmet_trigger = yes
				}
				portrait_has_trait_trigger = { TRAIT = augustus }
				AND = {
					NOT = { AND = { is_ruler = yes government_has_flag = government_is_mercenary  } } # Blocked for mercenaries
					NOT = { government_has_flag = government_is_republic }
				}
			}
		}
	}

	cfp_trait_laurel_headgear = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = cfp_trait_laurel
				range = { 0 1 }
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 60
				exists = this
				has_personality_extroverted_trigger = yes
				NOR = {
					portrait_wear_no_headgear_trigger = yes
					portrait_wear_helmet_trigger = yes
					government_has_flag = government_is_theocracy
				}
				OR = {
					AND = {
						portrait_has_trait_trigger = { TRAIT = scholar }
						learning >= 26
					}
					AND = {
						portrait_has_trait_trigger = { TRAIT = august }
						diplomacy >= 21
					}
				}
				AND = {
					OR = {
						portrait_western_clothing_trigger = yes
						portrait_byzantine_clothing_trigger = yes
						AND = {
							portrait_northern_clothing_trigger = yes
							NOT = { portrait_cfp_norse_clothing_trigger = yes }
						}
					}
				}
			}
		}
	}

## CFP Fantasy ##

	cfp_fantasy_witches = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = cfp_fantasy_witches
				range = { 0.35 0.40 }
			}
			accessory = {
				mode = add
				gene = additive_headgear
				template = no_additive
				range = { 0 1 }
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 110
				exists = this
				is_adult = yes
				portrait_religious_catholic_trigger = yes
				OR = {
					has_character_flag = wizard
					has_title = title:c_wizard
					has_title = title:b_magetrain
					primary_spouse = { 
						OR = {
							has_primary_title = title:c_wizard 
							has_primary_title = title:d_wizard
						}
					}
				}
			}
		}
	}

	rk_darkwiz = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = rk_darkwiz
				range = { 0 1 }
			}
			accessory = {
				mode = add
				gene = additive_headgear
				template = no_additive
				range = { 0 1 }
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 105
				exists = this
				portrait_has_trait_trigger = { TRAIT = witch }
			}
		}
	}

	rk_witch = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = rk_witch
				range = { 0 1 }
			}
			accessory = {
				mode = add
				gene = additive_headgear
				template = no_additive
				range = { 0 1 }
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 110
				exists = this
				has_character_flag = witch
			}
		}
	}
	
}
