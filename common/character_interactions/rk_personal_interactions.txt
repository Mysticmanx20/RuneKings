
# Prayer interaction 
activate_prayer_interaction = {
	interface_priority = 1
	category = interaction_category_friendly
	desc = activate_prayer_desc
	common_interaction = yes
	icon = prayer
	
	ignores_pending_interaction_block = yes

	is_shown = {
		scope:recipient = scope:actor
	}

	is_valid_showing_failures_only = {
		scope:actor = {
			piety > minor_piety_value
		}
	}

	can_send = {
		AND = {
			scope:actor = { piety > minor_piety_value }

			scope:actor = {
				NOT = {
					AND = {
						has_character_modifier = prayer_clarity
						has_character_modifier = prayer_burst_str
						has_character_modifier = prayer_thick_skin
						has_character_modifier = prayer_sharp_eye
						has_character_modifier = prayer_mystic_will
					}
				}
				NOT = {
					AND = {
						has_character_modifier = prayer_reflex
						has_character_modifier = prayer_super_str
						has_character_modifier = prayer_rock_skin
						has_character_modifier = prayer_hawk_eye
						has_character_modifier = prayer_mystic_lore
					}
				}
				NOT = {
					AND = {
						has_character_modifier = prayer_reflex2
						has_character_modifier = prayer_ult_str
						has_character_modifier = prayer_steel_skin
						has_character_modifier = prayer_eagle_eye
						has_character_modifier = prayer_mystic_might
					}
				}
			}
			
		}
	}

	cost = { 
		piety = { 
			value = {
				add = minor_piety_value
				if = { 
					limit = {
						scope:actor = { piety_level >= 4 }
					}
					multiply = 3
				}
				else_if = {
					limit = {
						scope:actor = { piety_level >= 2 }
					}
					multiply = 2
				}

			}

		} 
	
	}

	send_option = {
		is_valid = {
			scope:actor = { 
				NOT = { 
					OR = {
						has_character_modifier = prayer_thick_skin 
						has_character_modifier = prayer_rock_skin
						has_character_modifier = prayer_steel_skin
					}
				} 
			}
		}
		flag = def_prayer
		localization = activate_thick_skin
	}
	send_option = {
		is_valid = {
			scope:actor = { 
				NOT = { 
					OR = {
						has_character_modifier = prayer_burst_str
						has_character_modifier = prayer_super_str
						has_character_modifier = prayer_ult_str
					}
				} 
			}
		}
		flag = str_prayer
		localization = activate_burst_str
	}
	send_option = {
		is_valid = {
			scope:actor = { 
				NOT = { 
					OR = {
						has_character_modifier = prayer_clarity
						has_character_modifier = prayer_reflex
						has_character_modifier = prayer_reflex2
					}
				} 
			}
		}
		flag = atk_prayer
		localization = activate_clarity
	}
	send_option = {
		is_valid = {
			scope:actor = { 
				NOT = { 
					OR = {
						has_character_modifier = prayer_sharp_eye
						has_character_modifier = prayer_hawk_eye
						has_character_modifier = prayer_eagle_eye
					}
				} 
			}
		}
		flag = range_prayer
		localization = activate_sharp_eye
	}
	send_option = {
		is_valid = {
			scope:actor = { 
				NOT = { 
					OR = {
						has_character_modifier = prayer_mystic_will
						has_character_modifier = prayer_mystic_lore
						has_character_modifier = prayer_mystic_might
					}
				} 
			}
		}
		flag = magic_prayer
		localization = activate_mystic_will
	}
	
	auto_accept = yes

	on_accept = {
		
		scope:actor = {
			
			switch = {
				trigger = yes
				scope:def_prayer = {
					if = {
						limit = { piety_level >= 4 }
						add_character_modifier = {
							modifier = prayer_steel_skin years = 1
						}
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_steel_skin }
								}
							}
						}
					}
					else_if = {
						limit = { piety_level >= 2 }
						add_character_modifier = {
							modifier = prayer_rock_skin years = 1
						}
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_rock_skin }
								}
							}
						}
					}
					
					else = {
						add_character_modifier = { modifier = prayer_thick_skin years = 1 }
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_thick_skin }
								}
							}
						}
					}
					
				}
				scope:str_prayer = {
					
					if = {
						limit = { piety_level >= 4 }
						add_character_modifier = {
							modifier = prayer_ult_str years = 1
						}
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_ult_str }
								}
							}
						}
					}
					else_if = {
						limit = { piety_level >= 2 }
						add_character_modifier = {
							modifier = prayer_super_str years = 1
						}
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_super_str }
								}
							}
						}
					}
					
					else = {
						add_character_modifier = { modifier = prayer_burst_str years = 1 }
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_burst_str }
								}
							}
						}
					}
				}
				scope:atk_prayer = {
					
					if = {
						limit = { piety_level >= 4 }
						add_character_modifier = {
							modifier = prayer_reflex2 years = 1
						}
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_reflex2 }
								}
							}
						}
					}
					else_if = {
						limit = { piety_level >= 2 }
						add_character_modifier = {
							modifier = prayer_reflex years = 1
						}
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_reflex }
								}
							}
						}
					}
					
					else = {
						add_character_modifier = { modifier = prayer_clarity years = 1 }
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_clarity }
								}
							}
						}
					}
				}
				scope:range_prayer = {
					
					if = {
						limit = { piety_level >= 4 }
						add_character_modifier = {
							modifier = prayer_eagle_eye years = 1
						}
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_eagle_eye }
								}
							}
						}
					}
					else_if = {
						limit = { piety_level >= 2 }
						add_character_modifier = {
							modifier = prayer_hawk_eye years = 1
						}
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_hawk_eye }
								}
							}
						}
					}
					
					else = {
						add_character_modifier = { modifier = prayer_sharp_eye years = 1 }
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_sharp_eye }
								}
							}
						}
					}
				}
				scope:magic_prayer = {
					
					if = {
						limit = { piety_level >= 4 }
						add_character_modifier = {
							modifier = prayer_mystic_might years = 1
						}
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_mystic_might }
								}
							}
						}
					}
					else_if = {
						limit = { piety_level >= 2 }
						add_character_modifier = {
							modifier = prayer_mystic_lore years = 1
						}
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_mystic_lore }
								}
							}
						}
					}
					
					else = {
						add_character_modifier = { modifier = prayer_mystic_will years = 1 }
						hidden_effect = {
							send_interface_toast = {
								title = prayer.active
								left_icon = scope:actor
				
								show_as_tooltip = {
									add_character_modifier = { modifier = prayer_mystic_will }
								}
							}
						}
					}
				}

			}
			
		}
	}
}
